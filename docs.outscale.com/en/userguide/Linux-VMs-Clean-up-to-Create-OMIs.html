<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Linux VMs Clean-up to Create OMIs – OUTSCALE Public Documentation</title>
    <link rel="canonical" href="Linux-VMs-Clean-up-to-Create-OMIs.html">
    <meta name="generator" content="Antora 3.1.9">
    <link rel="stylesheet" href="../../_/css/site.css">
    <link rel="stylesheet" href="../../_/css/outscale.css">
    <link rel="stylesheet" media="screen" href="../../_/css/vendor/jstable.min.css">
    <link rel="shortcut icon" href="../../_/img/favicon.ico">
    <link rel="search" type="application/opensearchdescription+xml" href="_xml/opensearch.xml" title="OUTSCALE Docs EN">
    <meta name="page-component" content="en">
    <meta name="page-version" content="">
    <meta name="page-url" content="/en/userguide/Linux-VMs-Clean-up-to-Create-OMIs.html">
    <!-- Matomo -->
    <script>
    var _paq = window._paq = window._paq || [];
    /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
    _paq.push(['trackPageView']);
    _paq.push(['enableLinkTracking']);
    (function() {
        _paq.push(['setTrackerUrl', 'https://outscale.matomo.cloud/matomo.php']);
        _paq.push(['setSiteId', '15']);
        _paq.push(['HeatmapSessionRecording::disable']);
    })();
    </script>
    <script async defer src="../../_/js/vendor/matomo.min.js"></script>
    <!-- End Matomo Code -->
  </head>
  <body class="article">
    <header class="header" role="banner">
      <nav id="top-menu" aria-label="Main Navigation">
          <button id="top-menu-button" aria-expanded="false" aria-controls="entry-0">
            <span></span>
          </button>
          <ul id="entry-0">
              <li class="logo entry">
                  <a href="https://en.outscale.com"><img src="../../_/img/logo.svg" alt="Logo"></a>
              </li>
              <li class="entry">
                <a href="Home.html">Docs</a>
              </li>
              <li class="entry">
                <a href="../../api%3Fconsole.html">API</a>
              </li>
              <li class="dropdown entry">
                  <button aria-expanded="false" aria-controls="entry-3">AWS Compatibility</button>
                  <ul id="entry-3">
                      <li><a href="../../fcu.html">FCU</a></li>
                      <li><a href="../../lbu.html">LBU</a></li>
                      <li><a href="../../eim.html">EIM</a></li>
                      <li><a href="../../icu.html">ICU</a></li>
                      <li><a href="../../directlink.html">DirectLink</a></li>
                      <li><a href="OOS-API-Reference.html">OOS</a></li>
                      <li><a href="AWS-Compatibility-Matrix.html">Compatibility Matrix</a></li>
                  </ul>
              </li>
                            <li class="dropdown entry">
                  <button aria-expanded="false" aria-controls="entry-4">Tooling</button>
                  <ul id="entry-4">
                      <li><a href="About-Cockpit.html">Cockpit</a></li>
                      <li><a href="Installing-and-Configuring-OSC-CLI.html">Command-Line Interface (CLI)</a></li>
                      <li><a href="Terraform.html">Terraform</a></li>
                      <li><a href="https://www.packer.io/docs/builders/outscale.html" target="_blank" rel="noopener">Packer</a></li>
                      <li><a href="https://github.com/outscale/osc-sdk-python" target="_blank" rel="noopener">SDK for Python</a></li>
                      <li><a href="https://github.com/outscale/osc-sdk-go" target="_blank" rel="noopener">SDK for Go</a></li>
                      <li><a href="https://github.com/outscale/osc-sdk-js" target="_blank" rel="noopener">SDK for JavaScript</a></li>
                      <li><a href="https://github.com/outscale/osc-sdk-rust" target="_blank" rel="noopener">SDK for Rust</a></li>
                      <li><a href="https://github.com/outscale/frieza" target="_blank" rel="noopener">Frieza</a></li>
                      <li><a href="https://github.com/outscale/osc-logs" target="_blank" rel="noopener">osc-logs</a></li>
                      <li><a href="https://github.com/outscale/osc-libcurl-examples" target="_blank" rel="noopener">Using OUTSCALE API with libcurl</a></li>
                  </ul>
              </li>
                            <li class="entry">
                <a href="https://support.outscale.com/hc/en-us" target="_blank" rel="noopener">FAQs</a>
              </li>
              <li class="entry">
                <a href="Release-Notes.html">Release Notes</a>
              </li>
              <li class="right dropdown entry">
                  <button aria-expanded="false" aria-controls="entry-lang">English<span class="fa fa-globe fa-fw"></span></button>
                  <ul id="entry-lang">
                      <li><a href="../../fr/userguide/Nettoyage-des-VM-Linux-pour-créer-des-OMI.html">Français</a></li>
                  </ul>
              </li>
              <form id="search-field" class="right entry field has-filter" action="https://docs.outscale.com/en/userguide/Search.html" autocomplete="off">
                  <a>
                    <input id="search-input" name="q" type="text" placeholder="Search"><button type="submit" value=""></button>
                  </a>
                  <input type="checkbox" data-facet-filter="component:en" checked style="display: none">
              </form>
          </ul>
      </nav>
      <button class="nav-toggle"></button>
    </header>
<div class="body">
<div class="nav-container">
  <aside class="nav">
    <nav class="nav-panel-menu nav-menu is-active"></nav>
    <div data-panel="menu"></div>
  </aside>
</div>

<main class="article">
  <div class="content ">
<aside class="toc sidebar" data-title="Contents" data-levels="3">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Linux VMs Clean-up to Create OMIs</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This page lists the elements of a Linux <span class="tooltip" data-tooltip="instance in AWS-Compliant APIs">virtual machine (VM)</span> you can clean up before creating an OUTSCALE machine image (OMI), especially if you want to share this OMI with other users or to make it public.</p>
</div>
<div class="paragraph">
<p>An OMI created from a VM or from a snapshot has the same characteristics as this VM or the VM the snapshot is created from. Moreover, a VM can contain sensitive information that you do not want to share.</p>
</div>
<div class="paragraph">
<p>It is therefore strongly recommended to clean up these elements from your VM, or the VM the snapshot is created from, before creating the OMI.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_overview"><a class="anchor" href="Linux-VMs-Clean-up-to-Create-OMIs.html#_overview"></a>Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This page provides command samples for CentOS 7 <span class="tooltip" data-tooltip="instance in AWS-Compliant APIs">VMs</span>, but the list of elements is the same for other Linux VMs.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Clean the user information at the very end. To clean the information related to all users, you need to repeat the commands for each user (as explained in the page).</p>
</li>
<li>
<p>After cleaning your VM, it is recommenced to immediately stop it to create the OMI. You can then start it again if you want to keep it, but the cleanup has to be done again if you want to create another OMI.</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You must execute these commands as the <code>root</code> user of the VM. To switch to the <code>root</code> user, type: <code>sudo -s</code></p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_logs"><a class="anchor" href="Linux-VMs-Clean-up-to-Create-OMIs.html#_logs"></a>Logs</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_rsyslog"><a class="anchor" href="Linux-VMs-Clean-up-to-Create-OMIs.html#_rsyslog"></a>rsyslog</h3>
<div class="paragraph">
<p>Prevent creating new logs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">$ service rsyslog stop</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_logs_2"><a class="anchor" href="Linux-VMs-Clean-up-to-Create-OMIs.html#_logs_2"></a>Logs</h3>
<div class="paragraph">
<p>Clean the logs and log history:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">$ find /var/log -type f \| while read f; do echo -ne '' &gt; $f; done</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_temporary_files"><a class="anchor" href="Linux-VMs-Clean-up-to-Create-OMIs.html#_temporary_files"></a>Temporary Files</h3>
<div class="paragraph">
<p>Clean the temporary files on your <span class="tooltip" data-tooltip="instance in AWS-Compliant APIs">VM</span>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">$ /bin/rm -Rf /tmp/*
$ /bin/rm -Rf /var/tmp/*</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_vm_configuration"><a class="anchor" href="Linux-VMs-Clean-up-to-Create-OMIs.html#_vm_configuration"></a>VM Configuration</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_route_configuration_and_network_map"><a class="anchor" href="Linux-VMs-Clean-up-to-Create-OMIs.html#_route_configuration_and_network_map"></a>Route Configuration and Network Map</h3>
<div class="paragraph">
<p>Clean the route configuration and network map obtained when creating the <span class="tooltip" data-tooltip="instance in AWS-Compliant APIs">VM</span>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">$ /bin/rm -f /etc/sysconfig/network-scripts/{ifcfg,route}-eth[1-9]</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_dhcp_lease"><a class="anchor" href="Linux-VMs-Clean-up-to-Create-OMIs.html#_dhcp_lease"></a>DHCP Lease</h3>
<div class="paragraph">
<p>Clean the DHCP lease that is obtained when creating the VM:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">$ /bin/rm -f /var/lib/dhclient/dhclient*.lease</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ntp_servers"><a class="anchor" href="Linux-VMs-Clean-up-to-Create-OMIs.html#_ntp_servers"></a>NTP Servers</h3>
<div class="paragraph">
<p>Clean the list of NTP servers that is obtained when creating the VM:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">$ sed -i '/dhclient-script/d' /etc/ntp.conf</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_creation_information"><a class="anchor" href="Linux-VMs-Clean-up-to-Create-OMIs.html#_creation_information"></a>Creation Information</h3>
<div class="paragraph">
<p>Clean the information related to the first creation of the VM:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">$ /bin/rm -f /var/osc/*</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_user_password"><a class="anchor" href="Linux-VMs-Clean-up-to-Create-OMIs.html#_user_password"></a>User Password</h3>
<div class="paragraph">
<p>To check if there is any password, use the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">$ cat /etc/shadow</code></pre>
</div>
</div>
<div class="paragraph">
<p>To delete the passwords, use the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">$ passwd -d User_Name</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_user_data"><a class="anchor" href="Linux-VMs-Clean-up-to-Create-OMIs.html#_user_data"></a>User Data</h3>
<div class="paragraph">
<p>Clean the user data information stored by cloud-init:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">$ cloud-init clean</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_packages"><a class="anchor" href="Linux-VMs-Clean-up-to-Create-OMIs.html#_packages"></a>Packages</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Clean the packages:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">$ yum -y clean all</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_user"><a class="anchor" href="Linux-VMs-Clean-up-to-Create-OMIs.html#_user"></a>User</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_keypairs"><a class="anchor" href="Linux-VMs-Clean-up-to-Create-OMIs.html#_keypairs"></a>Keypairs</h3>
<div class="paragraph">
<p>To clean the keypairs of the <code>root</code> user, of the <code>outscale</code> user, and of any other user created in the <span class="tooltip" data-tooltip="instance in AWS-Compliant APIs">VM</span>, use the following commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">$ /bin/rm -f ~/.ssh/authorized_keys
$ /bin/rm -f $HOME/outscale/.ssh/authorized_keys
$ /bin/rm -f $HOME/User_Name/.ssh/authorized_keys</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Once you delete the keypairs, you will not be able to reconnect to the VM after you disconnect from it at the end of this procedure.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_user_configuration_information"><a class="anchor" href="Linux-VMs-Clean-up-to-Create-OMIs.html#_user_configuration_information"></a>User Configuration Information</h3>
<div class="paragraph">
<p>To clean the configuration information of the <code>root</code> user, of the <code>outscale</code> user, and of any other user created in the VM, use the following commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">$ /bin/rm -f ~/.viminfo
$ /bin/rm -f $HOME/outscale/.viminfo
$ /bin/rm -f $HOME/User_Name/.viminfo</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_emails"><a class="anchor" href="Linux-VMs-Clean-up-to-Create-OMIs.html#_emails"></a>Emails</h3>
<div class="paragraph">
<p>Clean any emails present on the VM:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">$ /bin/rm -f /var/spool/mail/*</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_user_history"><a class="anchor" href="Linux-VMs-Clean-up-to-Create-OMIs.html#_user_history"></a>User History</h3>
<div class="paragraph">
<p>To clean the history of the <code>root</code> user, of the <code>outscale</code> user, and of any other user created in the VM, use the following commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">$ /bin/rm -f ~/.bash_history
$ /bin/rm -f $HOME/outscale/.bash_history
$ /bin/rm -f $HOME/User_Name/.bash_history
$ history -c</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Related Pages</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="Creating-an-OMI-from-a-VM.html" class="xref page">Creating an OMI from a VM</a></p>
</li>
<li>
<p><a href="Creating-an-OMI-from-a-Snapshot.html" class="xref page">Creating an OMI from a Snapshot</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sidebar-button paragraph"><a onclick="printPage()"><strong>Export to PDF</strong> <i class="fa fa-file-pdf-o"></i></a></div>
</article>
  </div>
</main>
</div>
    <footer class="footer">
      <p>Copyright © 2025 Outscale SAS. All rights reserved. | <a href="Legal-Mentions.html" class="xref page">Legal Mentions</a></p>
      <p>This site was built with <a href="https://antora.org" target="_blank" rel="noopener">Antora</a> and <a href="https://github.com/outscale/osc-doc-framework" target="_blank" rel="noopener">osc-doc-framework</a>.</p>
    </footer>
    <script src="../../_/js/site-navigation-data.js"></script>
    <script id="navigator-script" src="../../_/js/nav.js"></script>
    <script id="site-script" src="../../_/js/site.js" data-ui-root-path="../../_"></script>
    <script src="../../_/js/outscale-right-sidebar.js"></script>
    <script src="../../_/js/outscale-tabs.js"></script>
    <script src="../../_/js/vendor/lunr.js"></script>
<script src="../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../.." data-snippet-length="120" data-stylesheet="../../_/css/outscale-search.css"></script>
<script async src="../../_/js/search-index.js"></script>
<script async src="../../_/js/search-page.js"></script>

    <script src="../../_/js/vendor/highlight.js"></script>
    <script async src="../../_/js/outscale-extra-highlight.js"></script>
    <script src="../../_/js/vendor/jstable.es5.min.js"></script>
    <script async src="../../_/js/outscale-tables.js"></script>
    <script async src="../../_/js/outscale-print.js"></script>
  </body>
</html>
