<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Tutorial: Setting Up MFA for Your Account Using a Certificate – OUTSCALE Public Documentation</title>
    <link rel="canonical" href="Tutorial-Setting-Up-MFA-for-Your-Account-Using-a-Certificate.html">
    <meta name="generator" content="Antora 3.1.9">
    <link rel="stylesheet" href="../../_/css/site.css">
    <link rel="stylesheet" href="../../_/css/outscale.css">
    <link rel="stylesheet" media="screen" href="../../_/css/vendor/jstable.min.css">
    <link rel="shortcut icon" href="../../_/img/favicon.ico">
    <link rel="search" type="application/opensearchdescription+xml" href="_xml/opensearch.xml" title="OUTSCALE Docs EN">
    <meta name="page-component" content="en">
    <meta name="page-version" content="">
    <meta name="page-url" content="/en/userguide/Tutorial-Setting-Up-MFA-for-Your-Account-Using-a-Certificate.html">
    <!-- Matomo -->
    <script>
    var _paq = window._paq = window._paq || [];
    /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
    _paq.push(['trackPageView']);
    _paq.push(['enableLinkTracking']);
    (function() {
        _paq.push(['setTrackerUrl', 'https://outscale.matomo.cloud/matomo.php']);
        _paq.push(['setSiteId', '15']);
        _paq.push(['HeatmapSessionRecording::disable']);
    })();
    </script>
    <script async defer src="../../_/js/vendor/matomo.min.js"></script>
    <!-- End Matomo Code -->
  </head>
  <body class="article">
    <header class="header" role="banner">
      <nav id="top-menu" aria-label="Main Navigation">
          <button id="top-menu-button" aria-expanded="false" aria-controls="entry-0">
            <span></span>
          </button>
          <ul id="entry-0">
              <li class="logo entry">
                  <a href="https://en.outscale.com"><img src="../../_/img/logo.svg" alt="Logo"></a>
              </li>
              <li class="entry">
                <a href="Home.html">Docs</a>
              </li>
              <li class="entry">
                <a href="../../api%3Fconsole.html">API</a>
              </li>
              <li class="dropdown entry">
                  <button aria-expanded="false" aria-controls="entry-3">AWS Compatibility</button>
                  <ul id="entry-3">
                      <li><a href="../../fcu.html">FCU</a></li>
                      <li><a href="../../lbu.html">LBU</a></li>
                      <li><a href="../../eim.html">EIM</a></li>
                      <li><a href="../../icu.html">ICU</a></li>
                      <li><a href="../../directlink.html">DirectLink</a></li>
                      <li><a href="OOS-API-Reference.html">OOS</a></li>
                      <li><a href="AWS-Compatibility-Matrix.html">Compatibility Matrix</a></li>
                  </ul>
              </li>
                            <li class="dropdown entry">
                  <button aria-expanded="false" aria-controls="entry-4">Tooling</button>
                  <ul id="entry-4">
                      <li><a href="About-Cockpit.html">Cockpit</a></li>
                      <li><a href="Installing-and-Configuring-OSC-CLI.html">Command-Line Interface (CLI)</a></li>
                      <li><a href="Terraform.html">Terraform</a></li>
                      <li><a href="https://www.packer.io/docs/builders/outscale.html" target="_blank" rel="noopener">Packer</a></li>
                      <li><a href="https://github.com/outscale/osc-sdk-python" target="_blank" rel="noopener">SDK for Python</a></li>
                      <li><a href="https://github.com/outscale/osc-sdk-go" target="_blank" rel="noopener">SDK for Go</a></li>
                      <li><a href="https://github.com/outscale/osc-sdk-js" target="_blank" rel="noopener">SDK for JavaScript</a></li>
                      <li><a href="https://github.com/outscale/osc-sdk-rust" target="_blank" rel="noopener">SDK for Rust</a></li>
                      <li><a href="https://github.com/outscale/frieza" target="_blank" rel="noopener">Frieza</a></li>
                      <li><a href="https://github.com/outscale/osc-logs" target="_blank" rel="noopener">osc-logs</a></li>
                      <li><a href="https://github.com/outscale/osc-libcurl-examples" target="_blank" rel="noopener">Using OUTSCALE API with libcurl</a></li>
                  </ul>
              </li>
                            <li class="entry">
                <a href="https://support.outscale.com/hc/en-us" target="_blank" rel="noopener">FAQs</a>
              </li>
              <li class="entry">
                <a href="Release-Notes.html">Release Notes</a>
              </li>
              <li class="right dropdown entry">
                  <button aria-expanded="false" aria-controls="entry-lang">English<span class="fa fa-globe fa-fw"></span></button>
                  <ul id="entry-lang">
                      <li><a href="../../fr/userguide/Tutoriel-Mettre-en-place-une-MFA-pour-votre-compte-avec-un-certificat.html">Français</a></li>
                  </ul>
              </li>
              <form id="search-field" class="right entry field has-filter" action="https://docs.outscale.com/en/userguide/Search.html" autocomplete="off">
                  <a>
                    <input id="search-input" name="q" type="text" placeholder="Search"><button type="submit" value=""></button>
                  </a>
                  <input type="checkbox" data-facet-filter="component:en" checked style="display: none">
              </form>
          </ul>
      </nav>
      <button class="nav-toggle"></button>
    </header>
<div class="body">
<div class="nav-container">
  <aside class="nav">
    <nav class="nav-panel-menu nav-menu is-active"></nav>
    <div data-panel="menu"></div>
  </aside>
</div>

<main class="article">
  <div class="content ">
<aside class="toc sidebar" data-title="Contents" data-levels="3">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Tutorial: Setting Up MFA for Your Account Using a Certificate</h1>
<div id="preamble">
<div class="sectionbody">
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can also set up multi-factor authentication (MFA) for Cockpit v2 using WebAuthn or an OTP. For more information, see <a href="Setting-Up-MFA-for-Your-Account-Using-WebAuthn-or-an-OTP.html" class="xref page">Setting Up MFA for Your Account Using WebAuthn or an OTP</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To set up multi-factor authentication (MFA) on your OUTSCALE account using an x509 certificate:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>You need to upload a Certificate Authority (CA) which will serve as the anchor for a chain of trust.</p>
</li>
<li>
<p>You then need to configure API access rules to require that all API requests provide a client certificate. If this client certificate is stored on a separate physical device, such as a smart card, it constitutes a possession factor and therefore a second authentication factor (compared to your access keys, the knowledge factor, which acts as the first authentication factor).</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Smart cards must follow the Personal Identity Verification (PIV) standard.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>You can then activate a trusted session with your API access policy to simplify your API access. If you are using Cockpit v2, a trusted session is automatically simulated for you.</p>
</li>
</ol>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Be careful when following this tutorial. Failing to properly configure your CA, client certificate, and API access rules can result in the locking of your account.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This procedure is based on OSC CLI. Once MFA is set up for your OUTSCALE account, you can configure a client certificate for other interfaces such as Cockpit v2 or Terraform.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_generate_a_ca"><a class="anchor" href="Tutorial-Setting-Up-MFA-for-Your-Account-Using-a-Certificate.html#_generate_a_ca"></a>Generate a CA</h2>
<div class="sectionbody">
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you already have a CA in PEM format, you can skip this section.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Generate a CA private key:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">$ openssl genrsa -aes256 -out ca-key.pem 4096</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It is recommended to protect your CA private key with a pass phrase.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Using the CA private key, generate a CA certificate:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">$ openssl req -new \
    -x509 \
    -days 365 \
    -key ca-key.pem \
    -out ca-certificate.pem \
    -config &lt;(cat /etc/ssl/openssl.cnf &lt;(echo -e "[ext]\nbasicConstraints = critical,CA:TRUE,pathlen:1")) \
    -extensions ext</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>This command contains a specific "basic constraints" configuration which is necessary for the CA certificate to be accepted in the OUTSCALE Cloud.</p>
</li>
<li>
<p>This command makes the CA certificate valid for one year via the <code>-days 365</code> parameter, but you can also specify a different value. For more information, see the <a href="https://www.openssl.org/" target="_blank" rel="noopener">official website of the OpenSSL command</a>.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Your CA private key is saved as <code>ca-key.pem</code> and your CA certificate as <code>ca-certificate.pem</code>.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_upload_your_ca"><a class="anchor" href="Tutorial-Setting-Up-MFA-for-Your-Account-Using-a-Certificate.html#_upload_your_ca"></a>Upload Your CA</h2>
<div class="sectionbody">
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Before you begin</strong>: Install OSC CLI. For more information, see <a href="Installing-and-Configuring-OSC-CLI.html" class="xref page">Installing and Configuring OSC CLI</a>.</p></td>
</tr>
</tbody>
</table>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Upload your CA certificate using OSC CLI:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">$ osc-cli api CreateCa \
    --Description "My company CA" \
    --CaPem="$(cat ca-certificate.pem)"</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Response sample</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">"Ca": {
    "CaFingerprint": "FINGERPRINT",
    "CaId": "ca-12345678",
    "Description": "My company CA"
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To verify that the CA was uploaded properly, you can compare the fingerprint of the above response with the fingerprint generated by this command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">$ openssl x509 -in ca-certificate.pem -noout -sha1 -fingerprint | awk '{gsub(/.*=/, ""); gsub(":",""); print tolower($0)}'</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Your CA certificate is now available for use in your OUTSCALE account.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configure_your_api_access_rules"><a class="anchor" href="Tutorial-Setting-Up-MFA-for-Your-Account-Using-a-Certificate.html#_configure_your_api_access_rules"></a>Configure Your API Access Rules</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create an API access rule to only allow API requests that provide a client certificate:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">$ osc-cli api CreateApiAccessRule \
    --CaIds '["ca-12345678"]' \
    --Description "Allow access with certificates validated by my CA"</code></pre>
</div>
</div>
</li>
<li>
<p>(Optional) Create an API access rule to only allow API requests originating from an IP that you have access to:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">$ osc-cli api CreateApiAccessRule \
    --IpRanges '["192.0.2.0/32"]' \
    --Description "Backup access if certificate access fails"</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If possible, use a different IP than the one you are currently using, such as a VPN IP, in order to properly test the access.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>List the IDs of all your API access rules:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">$ osc-cli api ReadApiAccessRules</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Response sample</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">    "ApiAccessRules": [
        {
            "ApiAccessRuleId": "aar-11111111",
            "CaIds": [],
            "Cns": [],
            "Description": "Allows all IPv4 domain",
            "IpRanges": [
                "0.0.0.0/0"
            ]
        },
        {
            "ApiAccessRuleId": "aar-22222222",
            "CaIds": [],
            "Cns": [],
            "Description": "Allows Outscale Cockpit of this region",
            "IpRanges": [
                "46.231.144.177/32"
            ]
        }
        {
            "ApiAccessRuleId": "aar-33333333",
            "CaIds": [
                "ca-12345678"
            ],
            "Cns": [],
            "Description": "Allow access with certificates validated by my CA",
            "IpRanges": []
        }
        {
            "ApiAccessRuleId": "aar-44444444",
            "CaIds": [],
            "Cns": [],
            "Description": "Backup access if certificate access fails",
            "IpRanges": [
                "192.0.2.0/32"
            ]
        }
    ]</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>By default, each account has the following API access rules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Global access is allowed (0.0.0.0/0).</p>
</li>
<li>
<p>Access from the web interface Cockpit of the account Region is allowed.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Delete the default API access rule that allows global access:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">$ osc-cli api DeleteApiAccessRule --ApiAccessRuleId "aar-11111111"</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_generate_a_client_certificate"><a class="anchor" href="Tutorial-Setting-Up-MFA-for-Your-Account-Using-a-Certificate.html#_generate_a_client_certificate"></a>Generate a Client Certificate</h2>
<div class="sectionbody">
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For a stronger MFA, you can use a separate physical device, such as a smart card, to generate and store your client certificates.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Generate a certificate private key and a certificate request:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">$ openssl req -new \
    -sha256 \
    -nodes \
    -newkey rsa:2048 \
    -keyout client-key.pem \
    -out client-certificate.csr</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you are using a separate physical device, adapt the <code>newkey</code> parameter value to your device specifications.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Your certificate private key is saved as <code>client-key.pem</code> and your certificate request as <code>client-certificate.csr</code>.</p>
</div>
</li>
<li>
<p>Using the above files, generate a client certificate signed by your CA:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">$ openssl x509 -req \
    -sha256 \
    -days 365 \
    -CAkey ca-key.pem \
    -CA ca-certificate.pem \
    -CAcreateserial \
    -in client-certificate.csr \
    -out client-certificate.pem \
    -extfile &lt;(echo "extendedKeyUsage = clientAuth")</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This command makes the client certificate valid for one year via the <code>-days 365</code> parameter, but you can also specify a different value. For more information, see the <a href="https://www.openssl.org/" target="_blank" rel="noopener">official website of the OpenSSL command</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Your client certificate is saved as <code>client-certificate.pem</code>.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configure_your_access"><a class="anchor" href="Tutorial-Setting-Up-MFA-for-Your-Account-Using-a-Certificate.html#_configure_your_access"></a>Configure Your Access</h2>
<div class="sectionbody">
<div class="sect2 tab">
<h3 id="OSC CLI_0"><a class="anchor" href="Tutorial-Setting-Up-MFA-for-Your-Account-Using-a-Certificate.html#OSC CLI_0"></a>Configuring Your Access for OSC CLI</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>To configure OSC CLI to use your client certificate, add a profile (named for example <code>secure</code>) in your <strong>.osc_sdk/config.json</strong> file:</p>
<div class="listingblock">
<div class="title">.osc_sdk/config.json</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
    "default": {
        "access_key": "ACCESSKEY",
        "secret_key": "SECRETKEY",
        "host": "outscale.com",
        "https": true,
        "method": "POST",
        "region": "eu-west-2"
    },
    "secure": {
        "access_key": "ACCESSKEY",
        "secret_key": "SECRETKEY",
        "host": "outscale.com",
        "https": true,
        "method": "POST",
        "region": "eu-west-2",
        "client_certificate": [
            "/PATHTO/client-certificate.pem",
            "/PATHTO/client-key.pem"
        ]
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Replace <code>ACCESSKEY</code>, <code>SECRETKEY</code>, <code>eu-west-2</code>, and <code>/PATHTO/</code> with the adequate values.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Test your <code>secure</code> profile by running any OSC CLI command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">$ osc-cli api ReadVms --profile "secure"</code></pre>
</div>
</div>
</li>
<li>
<p>If your <code>secure</code> profile works properly, you can delete the default API access rule that allows access from Cockpit, as well as the API access rule that allows an IP you have access to:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">$ osc-cli api DeleteApiAccessRule --profile "secure" --ApiAccessRuleId "aar-22222222"
$ osc-cli api DeleteApiAccessRule --profile "secure" --ApiAccessRuleId "aar-44444444"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Your account is now configured to only allow API requests that provide a client certificate.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you can no longer perform actions on your OUTSCALE account through the API access rules in place, you need to contact the Support team to regain access. For more information, see <a href="Technical-Support.html" class="xref page">Technical Support</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2 tab">
<h3 id="Cockpit v2_1"><a class="anchor" href="Tutorial-Setting-Up-MFA-for-Your-Account-Using-a-Certificate.html#Cockpit v2_1"></a>Configuring Your Access for Cockpit v2</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Convert your client certificate to the PKCS 12 format using the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">$ openssl pkcs12 \
    -inkey client-key.pem \
    -in client-certificate.pem \
    -export -out web-client-certificate.p12</code></pre>
</div>
</div>
</li>
<li>
<p>Test your access by logging in to Cockpit v2. For more information, see <a href="Logging-In-and-Out-of-a-Trusted-Session-Using-a-Certificate.html" class="xref page">Logging In and Out of a Trusted Session Using a Certificate</a>.</p>
</li>
<li>
<p>If you are able to log in, you can delete the default API access rule that allows access from Cockpit, as well as the API access rule that allows an IP you have access to:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">$ osc-cli api DeleteApiAccessRule --profile "secure" --ApiAccessRuleId "aar-22222222"
$ osc-cli api DeleteApiAccessRule --profile "secure" --ApiAccessRuleId "aar-44444444"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Your account is now configured to only allow API requests that provide a client certificate, including requests sent by Cockpit v2.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you can no longer perform actions on your OUTSCALE account through the API access rules in place, you need to contact the Support team to regain access. For more information, see <a href="Technical-Support.html" class="xref page">Technical Support</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_activate_a_trusted_session"><a class="anchor" href="Tutorial-Setting-Up-MFA-for-Your-Account-Using-a-Certificate.html#_activate_a_trusted_session"></a>Activate a Trusted Session</h2>
<div class="sectionbody">
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If your are using Cockpit v2, you do not need to activate a trusted session, as Cockpit v2 automatically simulates one for you.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Retrieve the IDs of all your access keys:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">$ osc-cli api ReadAccessKeys --profile "secure"</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Response sample</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">"AccessKeys": [
    {
        "AccessKeyId": "AAAAAAAAAAAAAAAA",
        "CreationDate": "YYYY-MM-DDThh:mm:ss.000Z",
        "LastModificationDate": "YYYY-MM-DDThh:mm:ss.000Z",
        "State": "ACTIVE"
    },
    {
        "AccessKeyId": "BBBBBBBBBBBBBBBB",
        "CreationDate": "YYYY-MM-DDThh:mm:ss.000Z",
        "LastModificationDate": "YYYY-MM-DDThh:mm:ss.000Z",
        "State": "ACTIVE"
    }
]</code></pre>
</div>
</div>
</li>
<li>
<p>Set expiration dates for all your access keys:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">$ osc-cli api UpdateAccessKey \
    --profile "secure" \
    --AccessKeyId "AAAAAAAAAAAAAAAA" \
    --State "ACTIVE" \
    --ExpirationDate "20XX-XX-XXTXX:XX:XXZ"

$ osc-cli api UpdateAccessKey \
    --profile "secure" \
    --AccessKeyId "BBBBBBBBBBBBBBBB" \
    --State "ACTIVE" \
    --ExpirationDate "20XX-XX-XXTXX:XX:XXZ"</code></pre>
</div>
</div>
<div class="paragraph">
<p>All your access keys now have finite lifetimes.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The access keys of EIM users cannot have expiration dates. If you are using EIM users in your account, you must delete their access keys. For more information, see <a href="Deleting-an-EIM-Access-Key.html" class="xref page">Deleting an EIM Access Key</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>To activate a trusted session, modify your API access policy:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">$ osc-cli api UpdateApiAccessPolicy \
    --profile "secure" \
    --MaxAccessKeyExpirationSeconds XXXXXX \
    --RequireTrustedEnv True</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>The value of the <code>MaxAccessKeyExpirationSeconds</code> parameter must be greater than or equal to the remaining lifetime of each access key of your account.</p>
</li>
<li>
<p>Your access keys can expire before the end of the trusted session. Make sure you renew them as needed.</p>
</li>
<li>
<p>There can be a small delay between the response of the command and the effective application of the trusted session.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Your trusted session is now activated. You no longer need to provide your client certificate until you deactivate the trusted session, except for specific actions. For more information, see <a href="About-Your-API-Access-Policy.html#_scope_of_a_trusted_session" class="xref page">About Your API Access Policy &gt; Scope of a Trusted Session</a>.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Related Pages</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="About-API-Access-Rules.html" class="xref page">About API Access Rules</a></p>
</li>
<li>
<p><a href="About-Your-API-Access-Policy.html" class="xref page">About Your API Access Policy</a></p>
</li>
<li>
<p><a href="About-Access-Keys.html" class="xref page">About Access Keys</a></p>
</li>
<li>
<p><a href="Installing-and-Configuring-OSC-CLI.html" class="xref page">Installing and Configuring OSC CLI</a></p>
</li>
<li>
<p><a href="Logging-In-and-Out-of-a-Trusted-Session-Using-a-Certificate.html" class="xref page">Logging In and Out of a Trusted Session Using a Certificate</a></p>
</li>
<li>
<p><a href="Setting-Up-MFA-for-Your-Account-Using-WebAuthn-or-an-OTP.html" class="xref page">Setting Up MFA for Your Account Using WebAuthn or an OTP</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Corresponding API Methods</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>OUTSCALE API</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="../../api%3Fconsole.html#3ds-outscale-api-ca" class="xref page">Ca</a></p>
</li>
<li>
<p><a href="../../api%3Fconsole.html#3ds-outscale-api-apiaccessrule" class="xref page">ApiAccessRule</a></p>
</li>
<li>
<p><a href="../../api%3Fconsole.html#3ds-outscale-api-apiaccesspolicy" class="xref page">ApiAccessPolicy</a></p>
</li>
<li>
<p><a href="../../api%3Fconsole.html#3ds-outscale-api-accesskey" class="xref page">AccessKey</a></p>
</li>
</ul>
</div></div></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sidebar-button paragraph"><a onclick="printPage()"><strong>Export to PDF</strong> <i class="fa fa-file-pdf-o"></i></a></div>
</article>
  </div>
</main>
</div>
    <footer class="footer">
      <p>Copyright © 2025 Outscale SAS. All rights reserved. | <a href="Legal-Mentions.html" class="xref page">Legal Mentions</a></p>
      <p>This site was built with <a href="https://antora.org" target="_blank" rel="noopener">Antora</a> and <a href="https://github.com/outscale/osc-doc-framework" target="_blank" rel="noopener">osc-doc-framework</a>.</p>
    </footer>
    <script src="../../_/js/site-navigation-data.js"></script>
    <script id="navigator-script" src="../../_/js/nav.js"></script>
    <script id="site-script" src="../../_/js/site.js" data-ui-root-path="../../_"></script>
    <script src="../../_/js/outscale-right-sidebar.js"></script>
    <script src="../../_/js/outscale-tabs.js"></script>
    <script src="../../_/js/vendor/lunr.js"></script>
<script src="../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../.." data-snippet-length="120" data-stylesheet="../../_/css/outscale-search.css"></script>
<script async src="../../_/js/search-index.js"></script>
<script async src="../../_/js/search-page.js"></script>

    <script src="../../_/js/vendor/highlight.js"></script>
    <script async src="../../_/js/outscale-extra-highlight.js"></script>
    <script src="../../_/js/vendor/jstable.es5.min.js"></script>
    <script async src="../../_/js/outscale-tables.js"></script>
    <script async src="../../_/js/outscale-print.js"></script>
  </body>
</html>
